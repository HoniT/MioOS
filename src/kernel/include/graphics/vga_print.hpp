// ========================================
// Copyright Ioane Baidoshvili 2025.
// Distributed under the terms of the MIT License.
// ========================================

#pragma once

#ifndef VGA_PRINT_HPP
#define VGA_PRINT_HPP

#pragma region VGA Text Mode

#define VGA_ADDRESS 0xB8000 // VGA address

// Size constraints
#define NUM_COLS 80
#define NUM_ROWS 25

// VGA text mode default color (white on black)
#define VGAT_COLOR 15 | (0 << 4)

#pragma endregion

#include <stdint.h>
#include <stddef.h>
#include <stdarg.h>

#define RGB_COLOR_BLACK        0x000000
#define RGB_COLOR_BLUE         0x0000AA
#define RGB_COLOR_GREEN        0x00AA00
#define RGB_COLOR_CYAN         0x00AAAA
#define RGB_COLOR_RED          0xAA0000
#define RGB_COLOR_MAGENTA      0xAA00AA
#define RGB_COLOR_BROWN        0xAA5500
#define RGB_COLOR_LIGHT_GRAY   0xAAAAAA
#define RGB_COLOR_DARK_GRAY    0x555555
#define RGB_COLOR_LIGHT_BLUE   0x5555FF
#define RGB_COLOR_LIGHT_GREEN  0x55FF55
#define RGB_COLOR_LIGHT_CYAN   0x55FFFF
#define RGB_COLOR_LIGHT_RED    0xFF5555
#define RGB_COLOR_PINK         0xFF55FF
#define RGB_COLOR_YELLOW       0xFFFF55
#define RGB_COLOR_WHITE        0xFFFFFF

extern uint32_t default_rgb_color;

enum PrintTypes {
    STD_PRINT,
    LOG_INFO,
    LOG_WARNING,
    LOG_ERROR
};

struct vga_coords {
	size_t col;
	size_t row;
};

/// @brief Represents a box section that VGA text can be written to
struct vga_section {
    uint32_t startX;
    uint32_t startY;
    uint32_t endX;
    uint32_t endY;

    uint32_t col;
    uint32_t row;

    vga_section(uint32_t startX, uint32_t startY, uint32_t endX, uint32_t endY) :
        startX(startX), startY(startY), endX(endX), endY(endY), col(0), row(0) {}
};

// 8x8 font, 95 printable ASCII characters (32 to 126)
const uint8_t font8x8_basic[95][8] = {
    // ' ' (32)
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    // '!' (33)
    {0x18,0x3C,0x3C,0x18,0x18,0x00,0x18,0x00},
    // '"' (34)
    {0x6C,0x6C,0x24,0x00,0x00,0x00,0x00,0x00},
    // '#' (35)
    {0x6C,0x6C,0xFE,0x6C,0xFE,0x6C,0x6C,0x00},
    // '$' (36)
    {0x18,0x3E,0x60,0x3C,0x06,0x7C,0x18,0x00},
    // '%' (37)
    {0x00,0xC6,0xCC,0x18,0x30,0x66,0xC6,0x00},
    // '&' (38)
    {0x38,0x6C,0x38,0x76,0xDC,0xCC,0x76,0x00},
    // ''' (39)
    {0x30,0x30,0x30,0x00,0x00,0x00,0x00,0x00},
    // '(' (40)
    {0x0C,0x18,0x30,0x30,0x30,0x18,0x0C,0x00},
    // ')' (41)
    {0x30,0x18,0x0C,0x0C,0x0C,0x18,0x30,0x00},
    // '*' (42)
    {0x00,0x66,0x3C,0xFF,0x3C,0x66,0x00,0x00},
    // '+' (43)
    {0x00,0x18,0x18,0x7E,0x18,0x18,0x00,0x00},
    // ',' (44)
    {0x00,0x00,0x00,0x00,0x18,0x18,0x30,0x00},
    // '-' (45)
    {0x00,0x00,0x00,0x7E,0x00,0x00,0x00,0x00},
    // '.' (46)
    {0x00,0x00,0x00,0x00,0x18,0x18,0x00,0x00},
    // '/' (47)
    {0x06,0x0C,0x18,0x30,0x60,0xC0,0x80,0x00},
    // '0' (48)
    {0x7C,0xC6,0xCE,0xD6,0xE6,0xC6,0x7C,0x00},
    // '1' (49)
    {0x18,0x38,0x18,0x18,0x18,0x18,0x7E,0x00},
    // '2' (50)
    {0x7C,0xC6,0x06,0x1C,0x70,0xC0,0xFE,0x00},
    // '3' (51)
    {0x7C,0xC6,0x06,0x3C,0x06,0xC6,0x7C,0x00},
    // '4' (52)
    {0x1C,0x3C,0x6C,0xCC,0xFE,0x0C,0x1E,0x00},
    // '5' (53)
    {0xFE,0xC0,0xF8,0x0C,0x06,0xC6,0x7C,0x00},
    // '6' (54)
    {0x3C,0x60,0xC0,0xFC,0xC6,0xC6,0x7C,0x00},
    // '7' (55)
    {0xFE,0xC6,0x0C,0x18,0x30,0x30,0x30,0x00},
    // '8' (56)
    {0x7C,0xC6,0xC6,0x7C,0xC6,0xC6,0x7C,0x00},
    // '9' (57)
    {0x7C,0xC6,0xC6,0x7E,0x06,0x0C,0x78,0x00},
    // ':' (58)
    {0x00,0x18,0x18,0x00,0x18,0x18,0x00,0x00},
    // ';' (59)
    {0x00,0x18,0x18,0x00,0x18,0x18,0x30,0x00},
    // '<' (60)
    {0x0C,0x18,0x30,0x60,0x30,0x18,0x0C,0x00},
    // '=' (61)
    {0x00,0x00,0x7E,0x00,0x7E,0x00,0x00,0x00},
    // '>' (62)
    {0x30,0x18,0x0C,0x06,0x0C,0x18,0x30,0x00},
    // '?' (63)
    {0x7C,0xC6,0x0C,0x18,0x18,0x00,0x18,0x00},
    // '@' (64)
    {0x7C,0xC6,0xDE,0xDE,0xDE,0xC0,0x7C,0x00},
    // 'A' (65)
    {0x38,0x6C,0xC6,0xFE,0xC6,0xC6,0xC6,0x00},
    // 'B' (66)
    {0xFC,0x66,0x66,0x7C,0x66,0x66,0xFC,0x00},
    // 'C' (67)
    {0x3C,0x66,0xC0,0xC0,0xC0,0x66,0x3C,0x00},
    // 'D' (68)
    {0xF8,0x6C,0x66,0x66,0x66,0x6C,0xF8,0x00},
    // 'E' (69)
    {0xFE,0x62,0x68,0x78,0x68,0x62,0xFE,0x00},
    // 'F' (70)
    {0xFE,0x62,0x68,0x78,0x68,0x60,0xF0,0x00},
    // 'G' (71)
    {0x3C,0x66,0xC0,0xC0,0xCE,0x66,0x3E,0x00},
    // 'H' (72)
    {0xC6,0xC6,0xC6,0xFE,0xC6,0xC6,0xC6,0x00},
    // 'I' (73)
    {0x7E,0x18,0x18,0x18,0x18,0x18,0x7E,0x00},
    // 'J' (74)
    {0x1E,0x0C,0x0C,0x0C,0xCC,0xCC,0x78,0x00},
    // 'K' (75)
    {0xE6,0x66,0x6C,0x78,0x6C,0x66,0xE6,0x00},
    // 'L' (76)
    {0xF0,0x60,0x60,0x60,0x62,0x66,0xFE,0x00},
    // 'M' (77)
    {0xC6,0xEE,0xFE,0xD6,0xC6,0xC6,0xC6,0x00},
    // 'N' (78)
    {0xC6,0xE6,0xF6,0xDE,0xCE,0xC6,0xC6,0x00},
    // 'O' (79)
    {0x38,0x6C,0xC6,0xC6,0xC6,0x6C,0x38,0x00},
    // 'P' (80)
    {0xFC,0x66,0x66,0x7C,0x60,0x60,0xF0,0x00},
    // 'Q' (81)
    {0x38,0x6C,0xC6,0xC6,0xDA,0x6C,0x3A,0x00},
    // 'R' (82)
    {0xFC,0x66,0x66,0x7C,0x6C,0x66,0xE6,0x00},
    // 'S' (83)
    {0x7C,0xC6,0x60,0x38,0x0C,0xC6,0x7C,0x00},
    // 'T' (84)
    {0x7E,0x7E,0x5A,0x18,0x18,0x18,0x3C,0x00},
    // 'U' (85)
    {0xC6,0xC6,0xC6,0xC6,0xC6,0xC6,0x7C,0x00},
    // 'V' (86)
    {0xC6,0xC6,0xC6,0xC6,0x6C,0x38,0x10,0x00},
    // 'W' (87)
    {0xC6,0xC6,0xC6,0xD6,0xFE,0xEE,0xC6,0x00},
    // 'X' (88)
    {0xC6,0x6C,0x38,0x10,0x38,0x6C,0xC6,0x00},
    // 'Y' (89)
    {0x66,0x66,0x66,0x3C,0x18,0x18,0x3C,0x00},
    // 'Z' (90)
    {0xFE,0xCC,0x18,0x30,0x60,0xC6,0xFE,0x00},
    // '[' (91)
    {0x3C,0x30,0x30,0x30,0x30,0x30,0x3C,0x00},
    // '\' (92)
    {0xC0,0x60,0x30,0x18,0x0C,0x06,0x02,0x00},
    // ']' (93)
    {0x3C,0x0C,0x0C,0x0C,0x0C,0x0C,0x3C,0x00},
    // '^' (94)
    {0x10,0x38,0x6C,0xC6,0x00,0x00,0x00,0x00},
    // '_' (95)
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF},
    // '`' (96)
    {0x30,0x18,0x0C,0x00,0x00,0x00,0x00,0x00},
    // 'a' (97)
    {0x00,0x00,0x78,0x0C,0x7C,0xCC,0x76,0x00},
    // 'b' (98)
    {0xE0,0x60,0x7C,0x66,0x66,0x66,0xDC,0x00},
    // 'c' (99)
    {0x00,0x00,0x7C,0xC0,0xC0,0xC0,0x7C,0x00},
    // 'd' (100)
    {0x1C,0x0C,0x7C,0xCC,0xCC,0xCC,0x76,0x00},
    // 'e' (101)
    {0x00,0x00,0x78,0xCC,0xFC,0xC0,0x7C,0x00},
    // 'f' (102)
    {0x3C,0x66,0x60,0xF8,0x60,0x60,0xF0,0x00},
    // 'g' (103)
    {0x00,0x00,0x76,0xCC,0xCC,0x7C,0x0C,0xF8},
    // 'h' (104)
    {0xE0,0x60,0x6C,0x76,0x66,0x66,0xE6,0x00},
    // 'i' (105)
    {0x18,0x00,0x38,0x18,0x18,0x18,0x3C,0x00},
    // 'j' (106)
    {0x0C,0x00,0x1C,0x0C,0x0C,0xCC,0xCC,0x78},
    // 'k' (107)
    {0xE0,0x60,0x66,0x6C,0x78,0x6C,0xE6,0x00},
    // 'l' (108)
    {0x38,0x18,0x18,0x18,0x18,0x18,0x3C,0x00},
    // 'm' (109)
    {0x00,0x00,0xEC,0xFE,0xD6,0xD6,0xC6,0x00},
    // 'n' (110)
    {0x00,0x00,0xDC,0x66,0x66,0x66,0x66,0x00},
    // 'o' (111)
    {0x00,0x00,0x7C,0xC6,0xC6,0xC6,0x7C,0x00},
    // 'p' (112)
    {0x00,0x00,0xDC,0x66,0x66,0x7C,0x60,0xF0},
    // 'q' (113)
    {0x00,0x00,0x76,0xCC,0xCC,0x7C,0x0C,0x1E},
    // 'r' (114)
    {0x00,0x00,0xDC,0x76,0x66,0x60,0xF0,0x00},
    // 's' (115)
    {0x00,0x00,0x7E,0xC0,0x7C,0x06,0xFC,0x00},
    // 't' (116)
    {0x30,0x30,0xFC,0x30,0x30,0x36,0x1C,0x00},
    // 'u' (117)
    {0x00,0x00,0xCC,0xCC,0xCC,0xCC,0x76,0x00},
    // 'v' (118)
    {0x00,0x00,0xC6,0xC6,0xC6,0x6C,0x38,0x00},
    // 'w' (119)
    {0x00,0x00,0xC6,0xD6,0xD6,0xFE,0x6C,0x00},
    // 'x' (120)
    {0x00,0x00,0xC6,0x6C,0x38,0x6C,0xC6,0x00},
    // 'y' (121)
    {0x00,0x00,0xC6,0xC6,0xC6,0x7E,0x06,0xFC},
    // 'z' (122)
    {0x00,0x00,0xFE,0x4C,0x18,0x32,0xFE,0x00},
    // '{' (123)
    {0x0E,0x18,0x18,0x70,0x18,0x18,0x0E,0x00},
    // '|' (124)
    {0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18},
    // '}' (125)
    {0x70,0x18,0x18,0x0E,0x18,0x18,0x70,0x00},
    // '~' (126)
    {0x76,0xDC,0x00,0x00,0x00,0x00,0x00,0x00}
};

namespace vga {
    extern int col_num;
    extern int row_num;

    // Screen features
    vga_section create_section(uint32_t startX, uint32_t startY, uint32_t endX, uint32_t endY);
    vga_section create_section(vga_coords start, vga_coords end);
    void update_cursor();
    void clear_text_region(const size_t col, const size_t row, const size_t len);
    void backspace(void);
    void clear_screen(void);
    void insert(const size_t col, const size_t row, const uint32_t color, const bool update_pos, const char* fmt, ...);
    void insert(const size_t col, const size_t row, const bool update_pos, const char* fmt, ...);

    void vgat_vprintf(const char* format, va_list args);
} // namespace vga


// Print functions
void kputchar(const uint32_t color, const char c);
void kputs(const uint32_t color, const char* str);
vga_coords kprintf(const char* fmt, ...);
vga_coords kprintf(const uint32_t color, const char* fmt, ...);
vga_coords kprintf(const PrintTypes print_type, const char* fmt, ...);
vga_coords kprintf(const PrintTypes print_type, const uint32_t color, const char* fmt, ...);
vga_coords kprintf(vga_section& sect, const char* fmt, ...);
vga_coords kprintf(vga_section& sect, const PrintTypes print_type, const char* fmt, ...);
vga_coords kprintf(vga_section& sect, const uint32_t color, const char* fmt, ...);
vga_coords kprintf(vga_section& sect, const PrintTypes print_type, const uint32_t color, const char* fmt, ...);
void kvprintf(vga_section* sect, const PrintTypes print_type, uint32_t color, const char* fmt, const va_list args);

vga_coords kvprintf_at(const size_t col, const size_t row, const PrintTypes print_type, const uint32_t color, const bool update_pos, const char* fmt, va_list args);

#endif // VGA_PRINT_HPP
